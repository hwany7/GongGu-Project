<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  	
<mapper namespace="post">

	<!-- 히트 상품 가져오기 -->
	<select id="getHitPostFromMain" resultType="dto.join.HitPostDto">
		select * from 
			(select p.category_id,
       			c.category_name,
		        pp.post_id, 
		        pp.post_title,
		        pp.current_amount,
		        p.product_name,
		        p.thumbnail,
		        p.image,
		        row_number() over (partition by p.category_id
		        order by p.category_id, pp.current_amount desc) as ranking
		        from product_gg p, post_gg pp, category_gg c
		        where p.product_id = pp.product_id and p.category_id = c.category_id  and pp.post_status = 'A'
	 		)
	 		where ranking =1
 	</select>
 	
 	<!-- postContent 페이지에 보여줄 content -->
 	<select id="getPostContentFromContent" parameterType="int" resultType="dto.join.PostContentDto">
 		select *
		from (
		    select post_id, post_gg.product_id, category_name, post_title, post_status, 
		    		product_name, image, product_model, current_amount, default_price,content, payment_amount
		    from post_gg, product_gg, category_gg
		    where post_gg.product_id = product_gg.product_id 
		    		and product_gg.category_id = category_gg.category_id)
		where post_id=#{post_id}
 	</select>
 	
 	<!-- 신청 수량 초과 방어하기 위해 현재 진행 수량 가져오기 -->
	<select id="getCurrentamountFromApply" parameterType="int" resultType="int">
		select current_amount from post_gg where post_id = #{post_id}
	</select> 
	
	 <!-- 그리고 진행수량 -->
	<select id="getMinamountFromApply" parameterType="int" resultType="int">
		select minimum_amount from post_gg where post_id = #{post_id}
	</select>


</mapper>